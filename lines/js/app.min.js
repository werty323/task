(()=>{"use strict";const e=document.getElementById("container"),t=document.getElementById("nextMoveBtn"),n=document.getElementById("resetBtn"),o=document.getElementById("score"),r=document.getElementById("endGameMessage");let l=0,c=null;const s={red:"#ff0000",blue:"#0000ff",green:"#00ff00",yellow:"#ffff00",purple:"#800080",orange:"#ffa500"};function u(e,t){if(e>=0&&e<10&&t>=0&&t<10){return!document.getElementById("plate_"+e+"_"+t).querySelector(".ball")}return console.error("Ошибка: Неправильные координаты."),null}function i(e){const t=e.replace("plate_","").split("_");return{x:parseInt(t[0],10),y:parseInt(t[1],10)}}function a(e){const t=e.target;if(t){if(c===t)return;c&&c.classList.remove("active"),c=t,c.classList.add("active");const{x:e,y:n}=i(c.parentElement.id),o=h(e,n);console.log("Выбран шар в клетке: ",e,n,o)}}function f(e){const t=e.target;if(!t.classList.contains("tile"))return;const{x:n,y:o}=i(t.id);console.log("Выбрана клетка: ",t.id),c?t.querySelector(".ball")?(c.classList.remove("active"),a({target:t.querySelector(".ball")})):function(e,t){if(!c)return void console.error("Ошибка: Шар не выбран для перемещения.");if(!u(e,t))return void console.error("Ошибка: Указанная клетка не пуста.");const{x:n,y:o}=i(c.parentElement.id);console.log("Текущие координаты шара:",n,o);const r=function(e,t,n,o){const r=[],l=[],c={};r.push({x:e,y:t,g:0,h:S(e,t,n,o)});for(;r.length>0;){r.sort(((e,t)=>e.g+e.h-(t.g+t.h)));const e=r.shift(),{x:t,y:s}=e;if(t===n&&s===o)return $(c,n,o);l.push(e);const i=M(t,s);for(const a of i){const{nx:i,ny:f}=a;if(!u(i,f)||l.find((e=>e.x===i&&e.y===f)))continue;const d=e.g+1,y=r.find((e=>e.x===i&&e.y===f));if(!y||d<y.g){c[`${i},${f}`]={x:t,y:s};const e=S(i,f,n,o);y?(y.g=d,y.h=e):r.push({x:i,y:f,g:d,h:e})}}}return I(),null}(n,o,e,t);if(null===r)return void console.log("Путь не найден");console.log("Найденный путь:",r),l=r,l.forEach((function(e){const[t,n]=e,o=document.getElementById("plate_"+t+"_"+n);o&&o.querySelector(".box").classList.add("step-active")})),setTimeout(q,1e3);var l;const s=document.getElementById("plate_"+e+"_"+t);c.parentElement.removeChild(c),s.appendChild(c),c.classList.remove("active"),c=null;const a=x(e,t);0===a?(_(3),m()||L()):m()||L()}(n,o):t.querySelector(".ball")&&a({target:t.querySelector(".ball")})}function d(e,t,n){const o=document.getElementById("plate_"+e+"_"+t),r=o.querySelector(".ball");r&&r.remove();const l=document.createElement("div");l.className="ball",l.style.backgroundColor=function(e){return s.hasOwnProperty(e)?s[e]:(console.error("Ошибка: Нет такого цвета в палитре."),null)}(n),l.addEventListener("click",a),o.appendChild(l)}function y(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+t(e[2])+t(e[3])}function h(e,t){const n=document.getElementById("plate_"+e+"_"+t).querySelector(".ball");if(n)for(let e in s)if(y(n.style.backgroundColor)===s[e])return e;return!1}function m(){for(let e=0;e<10;e++)for(let t=0;t<10;t++)if(u(e,t))return!0;return!1}function p(){if(!m())return L(),!1;let e,t;do{e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random())}while(!u(e,t));const n=Object.keys(s);return d(e,t,n[Math.floor(Math.random()*n.length)]),!0}function g(e,t,n,o,r){let l=[{x:e,y:t}],c=e+o,s=t+r;for(;c>=0&&c<10&&s>=0&&s<10&&h(c,s)===n;)l.push({x:c,y:s}),c+=o,s+=r;for(c=e-o,s=t-r;c>=0&&c<10&&s>=0&&s<10&&h(c,s)===n;)l.push({x:c,y:s}),c-=o,s-=r;return l}function x(e,t){const n=h(e,t);if(!n)return;const o=function(e,t,n){let o=[{x:e,y:t}],r=e-1,l=e+1;for(;r>=0&&h(r,t)===n;)o.push({x:r,y:t}),r--;for(;l<10&&h(l,t)===n;)o.push({x:l,y:t}),l++;return o}(e,t,n),r=function(e,t,n){let o=[{x:e,y:t}],r=t-1,l=t+1;for(;r>=0&&h(e,r)===n;)o.push({x:e,y:r}),r--;for(;l<10&&h(e,l)===n;)o.push({x:e,y:l}),l++;return o}(e,t,n),c=g(e,t,n,1,1),s=g(e,t,n,1,-1);let u=0;return o.length>=5&&(u+=o.length,v(o)),r.length>=5&&(u+=r.length,v(r)),c.length>=5&&(u+=c.length,v(c)),s.length>=5&&(u+=s.length,v(s)),u>0&&(l+=2*u,E()),u}function v(e){e.forEach((({x:e,y:t})=>{const n=document.getElementById(`plate_${e}_${t}`).querySelector(".ball");n&&n.remove()}))}function E(){o.textContent="Счет: "+l}function b(){l=0,E(),e.innerHTML="",B(),r.classList.add("hidden"),t.disabled=!1;document.querySelectorAll(".ball").forEach((e=>e.remove())),_(5,0)}function _(e,t=1200){setTimeout((()=>{for(let t=0;t<e;t++)if(!p())return void L();for(let e=0;e<10;e++)for(let t=0;t<10;t++)x(e,t)}),t)}function L(){r.textContent=`Игра окончена. Вы набрали ${l} очков`,r.classList.remove("hidden"),t.disabled=!0}function I(e){e?_(5,0):audio2.play()}function B(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){const o=document.createElement("div");o.className="tile",o.id="plate_"+n+"_"+t,o.style.left=40*n+"px",o.style.top=40*t+"px",e.appendChild(o),o.addEventListener("click",f);const r=document.createElement("div");r.className="box",o.appendChild(r),o.addEventListener("click",f)}}function q(){document.querySelectorAll(".step-active").forEach((function(e){e.classList.remove("step-active")}))}function S(e,t,n,o){return Math.sqrt((n-e)**2+(o-t)**2)}function M(e,t){const n=[];return e>0&&n.push({nx:e-1,ny:t}),e<9&&n.push({nx:e+1,ny:t}),t>0&&n.push({nx:e,ny:t-1}),t<9&&n.push({nx:e,ny:t+1}),n}function $(e,t,n){const o=[];let r={x:t,y:n};for(;e[`${r.x},${r.y}`];)o.push([r.x,r.y]),r=e[`${r.x},${r.y}`];return o.push([r.x,r.y]),o.reverse()}I(!1),t.addEventListener("click",I),n.addEventListener("click",(function(){audio1.play(),b()})),B(),b()})();